---
output: 
   html_document:
      css: style.css
runtime: shiny
fig_caption: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library("shiny")
library("shinydashboardPlus")
library("ggplot2")
library("viridis")
library("RColorBrewer")
library("knitr")
library("png")
library("cowplot")
library("plotly")
library("shinyWidgets")
library("tidyverse")
library("data.table")
library("DT")
```

<!-- <head> -->
<!-- <!-- Global site tag (gtag.js) - Google Analytics --> -->
<!-- <script async src="https://www.googletagmanager.com/gtag/js?id=UA-71167447-1"></script> -->
<!-- <script> -->
<!--   window.dataLayer = window.dataLayer || []; -->
<!--   function gtag(){dataLayer.push(arguments);} -->
<!--   gtag('js', new Date()); -->
<!--   gtag('config', 'UA-71167447-1'); -->
<!-- </script> -->
<!-- </head> -->

<a href="http://cieb.unibas.ch/" target = "_blank">![Foo](cieb.png){ width=25% }</a>
```{r, echo = F}
socialButton(url = "http://github.com/cieb-unibas",  type = "github")
socialButton(url = "https://twitter.com/cieb_unibas",  type = "twitter")
a(actionButton(inputId = "email1", label = "Mail us",
                 icon = icon("envelope", lib = "font-awesome")),
    href="mailto:cieb@unibas.ch")
```

<br>


# <font color='#68838B'>***Is Switzerland more innovative than usually thought?*** 
**Cross-border commuting and inventions 'Made in Switzerland'** </font>


<br>

*September 2020* by <a href="https://wwz.unibas.ch/de/personen/matthias-niggli/" target = "_blank">Matthias Niggli</a>, <a href="https://wwz.unibas.ch/de/personen/christian-rutzer/" target = "_blank">Christian Rutzer</a> and <a href="https://wwz.unibas.ch/de/personen/dragan-filimonovic/" target = "_blank">Dragan Filimonovic</a>

![TitlePic](title_picture.jpg)
Picture: <a href="https://www.flickr.com/photos/stormsworld/8456586910/in/photolist-JfMjzY-Jf3uBk-9HwYDV-ZiCo9F-2jagrVH-HMX3CB-szWiqL-PsKy3L-bRHW5-HbJ87t-mWUYYB-J6PXd-228e7G7-nX4vQD-GAoNUV-AnHZzL-QonY9T-TUXSe1-MynNKE-yoSd93-dwmhsa-WyYCTY-7oFhzy-easv3-4VR2iw-BG4XB8-UkSxzU-ZbG9qo-uYNiyQ-aq6HJV-2gTznUx-3dSjtL-P2g2FQ-8xkuwR-6nJEim-5bA2Ve-5bA2yK-7Xo2QH-8qknKq-5aLf3M-t8HmX-8upbZT-3avCQY-dThdEA-2gaaCH-C2ckEz-5aQ6UU-26Frxpu-bV9qz-57bbjv" target = "_blank">Barry Davis | Flickr</a>

```{r, echo = F}
renderText("Share this article") 
    socialButton(url = "http://twitter.com/", type = "twitter")
    socialButton(url = "http://facebook.com/", type = "facebook")
    socialButton(url = "http://linkedin.com/", type = "linkedin")
    socialButton(url = "http://xing.com/", type = "xing")
```

<br>

**Over 300 000 people from neighboring countries regularly cross the border to work in Switzerland. Many of them contribute substantially to the development of new innovations by Swiss companies. At the same time, the work of such cross-border commuting inventors is often not properly considered by standard innovation measures. As a result, the Swiss economy could be even more innovative than generally thought. In fact, innovative activity in Switzerland could be underestimated by around 10% for the country as a whole - and by up to 30% for some specific regions and industries.**

Cross-border commuters are important for the Swiss economy. This is especially the case for some Swiss regions and the industries that these regions have specialized in. For example, the most recent figures of the <a href = https://www.bfs.admin.ch/bfs/en/home/statistics/work-income/employment-working-hours/employed-persons/swiss-foreign-nationals/cross-border-commuters.html target = “_blank”> Swiss Federal Statistic Office</a> highlight that the Lake Geneva region and the region of Northwestern Switzerland together already attract almost 200 000 cross-border commuters. As for industries, we can look at the Swiss pharmaceutical sector – notably the country’s largest exporter. The pharmaceutical industry employs so many cross-border commuters that without taking them into account its labor productivity would, for example, be substantially overestimated (see  <a href = Link Output Dragan target = “_blank”>Title Output Dragan </a>). 

If cross-border commuters play such an important role for economic activity in Switzerland, what about their role for the development of new inventions? Are these workers also substantially contributing to innovations by Swiss companies? And are there differences across industries in how strongly they rely on cross-border commuting workers?

In a very recent research paper, <a href = https://www.research-collection.ethz.ch/bitstream/handle/20.500.11850/432769/wp_486.pdf?sequence=1&isAllowed=y target = “_blank”>Beerli, Ruffner, Siegenthaler & Peri (2020)</a> argue that liberalizations of cross-border commuting restrictions in Switzerland have fostered the development of new innovations by Swiss companies in border regions. Simultaneously, this increase in inventive activity has fostered job market opportunities and raised labor demand for domestic workers. The study shows that through this mechanism the higher numbers of cross-border commuters after the liberalizations did not cause downward pressure on wages or raise unemployment of neither higher nor lower educated domestic workers. In contrast, the liberalization even increased wages of high-skilled workers. In general, these findings are in line with other studies suggesting that Switzerland benefits from cross-border workers and immigration as such (see for example <a href = https://cdn.avenir-suisse.ch/production/uploads/2020/09/personenfreizuegigkeit_analyse.pdf target = “_blank”>Avenir Suisse, 2020</a> for an overview or <a href = https://www.avenir-suisse.ch/grenzgaenger-teil-der-loesung-nicht-des-problems/ target = “_blank”>Salvi, 2014</a> for a short case study).

In what follows, we use big data on patents to investigate in more detail to what extent cross-border commuters contribute to new inventions discovered in Switzerland. The crucial issue for such an analysis is how to determine the origin of a patent and how to identify cross-border commuters in patent data. This is what is outlined in the next section.

<br>

## <font color='#68838B'>**How to determine the origin of an invention?**</font>

Every other year, reports such as the <a href = https://www.globalinnovationindex.org/Home target = “_blank”>Global Innovation Index</a>, the <a href = https://www.weforum.org/reports/how-to-end-a-decade-of-lost-productivity-growth target = “_blank”>Global Competitiveness Report</a> or the <a href = https://www.wipo.int/publications/en/series/index.jsp?id=38 target= “_blank”>World Intellectual Property Report</a> evaluate the innovative capacity of countries. One of the measures that these studies typically use are patents. More precisely, they look at the number of patents that were filed by inventors of a given country. This number can be determined because patent documentations always state the residence countries of all the inventors for any given patent. You can see this in an example below.

<br>
<center>
<a href="https://patentimages.storage.googleapis.com/2d/2c/18/51725e50ce657b/US10029262.pdf" target = "_blank">
![](example_patent_multicountry.jpg){ width=80% }</a> 
</center>
<br>

This patent states nine different “Inventors”. Five are from Germany and four are from Switzerland. The German locations (mostly from the area of Karlsruhe) and the Swiss ones (from the area around Bern) are rather far away from each other. This suggests that two different labs collaborated for this patent and the inventors did not all work in the same place. Some of the research was probably conducted in Germany and some was in Switzerland. There are two possibilities to link patents to countries if more than one country is mentioned on a patent. The first option is to simply raise the patent count of all the mentioned countries equally by one. The second option is to proportionally divide the patent among the countries according to the share of inventors from each country. With the first option, our example-patent would be equally assigned to Germany and Switzerland. With the latter one, $\frac{5}{9}$ of the patent would be assigned to Germany and $\frac{4}{9}$ to Switzerland. This approach takes into account that there were more German than Swiss residents involved in the development of the patent.

<div class=bloc_div>
<blockquote>***Such a patent would not be assigned to Switzerland even though all the research and development was conducted in a company’s Swiss-based facility.***</blockquote> 
</div>

There is also a third option. Instead of focusing on inventors, one can consider the location of the company that owns the patent. In our example, this is the location of the patent’s “Assignee”. In this case, the patent is owned by selFrag AG from Kerzers, Switzerland, and it would therefore be attributed to Switzerland only. Because of this - and also because patents are sometimes filed by foreign subsidiaries or headquarters - company addresses are rarely used to determine patent origins. For more information on how to determine the origin of patents, see e.g. <a href = https://www.sbfi.admin.ch/sbfi/en/home/services/publications/data-base-publications/intellectual-property.html target = “_blank”>Bechthold & de Rassenfosse (2019)</a> or a recent report by <a href = https://www.bertelsmann-stiftung.de/fileadmin/files/user_upload/BST_Weltklassepatente_2020_DT.pdf target = “_blank”>Bertelsmann (p. 68)</a> that briefly and comprehensively discusses the pros and cons of different options. The optimal choice mostly depends on the question one wants to answer. In this article, we want to investigate innovative capacities in Switzerland. For this purpose, it is best to follow the most common approach, which is to look at inventor addresses and to use shares to assign patents to countries.

Now, for the case of Switzerland, recall the very high numbers of cross-border commuters in, for example, Geneva or Basel. What if *all* the inventors of a patent developed in Switzerland live in neighboring countries and commute to a workplace in Switzerland? Such a patent would not be assigned to Switzerland even though all the research and development was conducted in a company’s Swiss-based facility. In addition, focusing on the location of the firm would also not solve the problem if the patent was filed by a foreign affiliate of the Swiss-based firm. The picture below shows an example of a patent with exactly these characteristics.

<br>
<center>
<a href="https://patentimages.storage.googleapis.com/d3/fc/90/f9374c9864e9b2/US7786128.pdf" target = "_blank">
<center>![](example_patent_crossbord.jpg){ width=80% }</a> 
</center>
<br>

All the inventors of this patent live in Germany or France and the assignee of the patent is a U.S.-affiliate of Swiss pharmaceutical giant Hoffmann-La Roche. With the above-mentioned approaches, such a patent would never be attributed to Switzerland. However, the places of residence of all inventors are very close to the region of Basel (e.g. Grenzach-Wylen, Freiburg). Furthermore, Hoffmann-La Roche’s headquarter is located in Basel and some of its major research facilities are in this region. Therefore, it is very likely that this patent was in fact developed in Basel by cross-border commuters from Germany and France and later filed at the <a href = “https://www.uspto.gov/” target = “_blank”>United States Patent and Trademark Office (USPTO)</a> by a U.S. branch of Hoffmann-La Roche. The actual invention, however, was conducted in Switzerland and the patent should thus also be attributed to Switzerland.

<br>


## <font color='#68838B'>**Cross-border commuters and innovation in Switzerland** </font>

In what follows, we investigate the number of inventions by cross-border commuters in Switzerland. For this analysis, we use patent data from the <a href = “https://www.uspto.gov/” target = “_blank”>USPTO</a> for U.S. patents and from the <a href="http://www.oecd.org/sti/inno/intellectual-property-statistics-and-analysis.htm" target ="blank">OECD</a> for European patents. In this <a href = “xxx” target = “_blank”>report (Link Output Christian)</a> you can read more about the datasets we use for all of our analyses and how they were processed. In the textbox below, you find a description of how we identify cross-border commuting inventors in Switzerland.

<br>

<div class="box_div">
<p style="font-size:18px">**Searching for cross-border commuting inventors in Switzerland**</p>
<details>
  <summary>*Click here to read about our empirical approach*</summary>

The patent data we use for the first step of the analysis is from the <a href = “https://www.uspto.gov/” target = “_blank”>USPTO</a>. It covers the period 1990 to 2015 and is corrected for patent equivalents (for more information on patent equivalents see e.g. <a href = “xxx” target = “_blank”>xxx</a> ). This dataset features information on the resident countries of inventors and companies. Furthermore, it also contains the geographical coordinates of their resident addresses. Combining these pieces of information allows us to develop an approach to empirically identify cross-border commuting inventors in Switzerland.

In principle, a patent is a candidate for being co-invented by a cross-border commuter if this inventor’s resident country is not Switzerland, but the company that owns the patent is based in Switzerland. Of course, however, this would be way too broad for a definition of cross-border commuting inventors in Switzerland. Recall, for example, our first example patent: The company was based in Switzerland and several inventors were living in Germany. As outlined above, this does not mean that they are necessarily cross-border commuters. For example, one of the German inventors lived in Hamburg and it is almost impossible that somebody is commuting over such a huge distance to Switzerland. 

Therefore, we need to refine the general approach. In order to do this, we introduce a limit on the distance between company and inventor locations. If the distance is too large, we consider commuting impossible. To calculate distances, we use the coordinates of inventor and company residence addresses. We then assign the cross-border commuter status if

1. inventors are not living in Switzerland **and** 
2. the company that owns the patent is based in Switzerland **and** 
3. inventors are not living too far away from where the Swiss company is located. 
  
Consequently, an inventor who is mentioned on a patent filed by a Basel-based company but is living in Hamburg would not be considered as a cross-border commuter. In turn, an inventor living in Loerrach would be. Patents that were co-invented by such inventors then get reassigned to Switzerland

However, this might still miss some cross-border commuters. What if the Swiss company did file the patent through a foreign affiliate as in our second example? The solution is to (…)

Sometimes Swiss companies file patents only at the <a href = “https://www.epo.org/” target = “_blank”>European Patent Office (EPO)</a> and not at the USPTO. Up to now, we have not included EPO patents in our analysis, which could be a major shortcoming. The reason is that data on EPO patents, which has been made available by the <a href="http://www.oecd.org/sti/inno/intellectual-property-statistics-and-analysis.htm" target ="blank">OECD</a>, does not have coordinate information. Therefore, we need an alternative approach to also check for cross-border commuters on EPO patents. We proceed in the following way: First, because we already reassigned USPTO patents, we only consider EPO patents from Swiss-based companies that do not have an equivalent USPTO patent. As before, we then check if the resident country of the company that owns the patent is Switzerland, but the inventor lives someplace else. As before, we must then consider whether the locations of the inventor and the company are not too far away. Instead of coordinates, we now use the resident *regions* of inventors and companies. More precisely, we assume that only inventors from foreign regions that are close to the Swiss border can commute to a workplace in Switzerland. We define these regions to be "Freiburg" and "Schwaben" for Germans, "Alsace", "Rhône-Alpes", "Lorraine" and "Franche-Comté" for people from France, "Lombardy" and "Piedmont" for Italians and the region of “Vorarlberg” for Austrians. Inventors who live outside of these regions are excluded to be considered as potential cross-border commuters, because the distance to the Swiss border would be too far. Furthermore, we make additional restrictions that inventors from Germany only commute to the Swiss regions "Northwestern Switzerland", "Zürich" or "Eastern Switzerland", Italians only to “Ticino”, Austrians only to “Eastern Switzerland” and French commuters only to "Northwestern Switzerland" or the "Lake Geneva Region”.

To summarize, we assign the cross-border commuter status to EPO patent inventors only if 

1.	inventors are not living in Switzerland but in regions close to its borders **and** 
2.	the company that owns the patent is based in Switzerland **and** 
3.	the company is located in a Swiss region which is close to the foreign region where the inventor lives. 

Combined, these definitions suggest that our approach to identify cross-border commuters on EPO patents should result in a lower bound.

Combined, these definitions suggest that our approach to identify cross-border commuters on EPO patents should result in a lower bound. Together, our results for the USPTO and the EPO patents, highlight that, over time, 23’047 patents  were likely co-developed by cross-border commuters in Switzerland.  In the next section, we discuss how this affects how we look at Swiss innovation activity.
</details>
</div>

<br>

Let us start by focusing on the number of inventors who commute to a Swiss workplace from neighboring countries. The Figure below shows the absolute number of cross-border commuting inventors differentiated by country of origin.

<br>

```{r, echo = FALSE}
## LOAD ALL .CSV FILES ---------------------------------------------------------------
csv_files <- list.files(pattern = ".csv")
df_list <- lapply(csv_files, read.csv)
names(df_list) <- gsub(pattern = ".csv", replacement = "", csv_files)
max_year <- 2015 # do not use data after 2015 because data quality is poor

## LOAD HELPER-FUNCTION -------------------------------------------------------------
source(file = "reshape_fun.R", local = knitr::knit_global()) 
```

```{r, echo = FALSE, fig.asp = 0.5}

#### ORIGIN OF CROSS-BORDER COMMUTERS: ------------------------------------------------------------

# renderPlotly({
 renderPlot({
   
  # define the data to plot
  plot_data <- df_list[["neighboring_ctry"]] %>% filter(p_year <= max_year)
  # plot_data <- mutate(plot_data, `Country of origin` = paste0(ctry_inv, "\nCount: ", count))

  # make the plot
  # ggplotly(
  ggplot(plot_data)+#, aes(label = `Country of origin`))+
  geom_area(aes(x = p_year, y = count, fill = ctry_inv), alpha = 0.8)+
  scale_fill_viridis(discrete = TRUE, option = "inferno", name = "", 
                     labels = c("Austria", "Germany", "France", "Italy")) +
  labs(x = "Year", y = "Number of cross-border commuting inventors") +
  theme(legend.position="bottom",
        panel.background = element_blank(),
        panel.grid.major.y = element_line(colour = "black", linetype = "dotted"),
        axis.title = element_text(face = "bold"),
        axis.line = element_line())#,
  # tooltip = c("label"), dynamicTicks = FALSE)
})
```
<span style="font-size:0.8em">*Source: Authors' own estimations based on data from the <a href="https://www.uspto.gov/" target ="blank">USPTO</a> and the <a href = "http://www.oecd.org/sti/inno/intellectual-property-statistics-and-analysis.htm" target ="blank">OECD</a>. The data used for this plot is available on  <a href=https://github.com/cieb-unibas/innovation-origins" target="_blank">GitHub</a>.*</span>

<br>
</a>

At the beginning of the 1990s there were relatively few cross-border commuting inventors – most of them coming from Germany to Switzerland. However, until 2005 their number has increased for all neighboring countries to a combined total of over 1000 people. This aligns nicely with the findings of  <a href = https://www.research-collection.ethz.ch/bitstream/handle/20.500.11850/432769/wp_486.pdf?sequence=1&isAllowed=y target = "_blank">Beerli, Ruffner, Siegenthaler & Peri (2020)</a>. These authors document that inflows of cross-border workers to Swiss border regions increased substantially following liberalizations at the beginning of the 21st century. Based on survey data, they point out that this additional inflow was especially relevant for research and development activities. Although it is important to note that we do not investigate any causal effects of the mentioned liberalizations, patent data on cross-border commuting inventors seems to at least support this finding. Even more importantly, not considering all these cross-border commuting inventors and their corresponding patents could result in substantially underreporting Switzerland’s innovative output.

The extent of this bias can be seen in the next plot. Focus on the colored areas first. This time, they show the absolute number of patents invented by Swiss residents (orange) and cross-border commuters (purple) respectively. Patents have increased over time for both Swiss residents and cross-border commuters alike (for a general overview on the patenting in Switzerland see <a href = “https://www.research-collection.ethz.ch/bitstream/handle/20.500.11850/119256/eth-49547-01.pdf?sequence=1&isAllowed=y” target = “_blank”> Arvanitis et al., 2015</a>). Also, we can immediately see that Switzerland’s patent output is clearly higher when also considering cross-border commuting inventors. The black solid line states the share of patents that were invented by cross-border commuters (i.e. the share of the purple area). It is quite impressive. Already in 1990, around 5% of all patents developed in Switzerland were inventions by cross-border commuters. This share doubled to around 10% in 2005 and has remained relatively stable ever since.

```{r, echo = FALSE, warning = FALSE, fig.asp = 0.5}

#### CROSS-BORDER COMMUTERS IN SWITZERLAND: -------------------------------------------

# load and prepare the data 
plot_data <- df_list[["CH_overall"]] %>% rename(`Swiss residents` = Swiss_based, Commuters = commuters)
plot_data <- plot_data %>%
  mutate(share = share -1) %>%
  filter(p_year <= max_year) %>%
  gather(key = Type, value = number, `Swiss residents`, Commuters)
plot_data <- plot_data %>% mutate(Status = paste0(Type, "\nCount: ", trunc(number)))
plot_data <- plot_data %>% mutate(Share = paste0(round(100 * share, 1), "%"))

# define parameters to transform the data to get 2nd axis:
ylim_absolute <- c(0, 5000)
ylim_share <- c(0, 0.15)
b <- diff(ylim_absolute)/diff(ylim_share)
a <- b*(ylim_absolute[1] - ylim_share[1])

# renderPlotly({
#   ggplotly(
renderPlot({
    ggplot(plot_data)+#, aes(label = Status))+
    geom_area(aes(x = p_year, y = - a + number / b, fill = Type), alpha = 0.8)+
    geom_line(aes(x = p_year, y = share), color = "black", size = 1)+
    scale_fill_viridis(discrete = TRUE, option = "inferno", begin = 0.3, end = 0.7,
                       labels = c("Patents by cross-border commuters", "Patents by Swiss residents"), name = "") +
    scale_y_continuous("Share of patents by cross-border commuters",
                       sec.axis = sec_axis(~ (. + a) * b, name = "Total number of patents"), 
                       labels = c("0%", "5%", "10%", "15%"))+
    xlab("Year") +
    theme(legend.position="bottom",
          panel.background = element_blank(),
          panel.grid.major.y = element_line(colour = "black", linetype = "dotted"),
          axis.title = element_text(face = "bold"),
          axis.line = element_line())#,

#     tooltip = c("label"), dynamicTicks = FALSE)
})

### ALTERNATIVE USING PLOTLY -------------------------------------------------------------
# renderPlotly({
#   ggplotly(
#     ggplot(plot_data)+
#     geom_area(aes(x = p_year, y = number, fill = Type, label = Status), alpha = 0.8)+
#     geom_line(aes(x = p_year, y = a + share * b, label = Share), color = "black")+
#     scale_fill_viridis(discrete = TRUE, option = "inferno", begin = 0.3, end = 0.7,
#                        labels = c("Cross-Border Commuters", "Swiss Residents"), name = "") +
#     scale_y_continuous("Total number of patents",
#                        sec.axis = sec_axis(~ (. - a) / b, 
#                                            name = "Share of patents by cross-border commuters"), 
#                        limits = c(0, 6000)
#                        )+
#     xlab("Year") +
#     theme(legend.position="none",
#           panel.background = element_blank(),
#           panel.grid.major.y = element_line(colour = "black", linetype = "dotted"),
#           axis.title = element_text(face = "bold"),
#           axis.line = element_line()),
# 
#      tooltip = c("label", "text"), dynamicTicks = FALSE)
# })
```
<span style="font-size:0.8em">*Source: Authors' own estimations based on data from the <a href="https://www.uspto.gov/" target ="blank">USPTO</a> and the <a href="http://www.oecd.org/sti/inno/intellectual-property-statistics-and-analysis.htm" target ="blank">OECD</a> . The data used for this plot is available on  <a href=https://github.com/cieb-unibas/innovation-origins" target="_blank">GitHub</a>.*</span>

<br>

What do these findings imply? First and foremost, it means that Swiss innovative activity could be underestimated by around 10% if the work of cross-border commuters is not considered. Second, as the share of patents by cross-border commuters did not increase for the last 10 years, it seems unlikely that cross-border commuters did substitute domestic inventors.

<div class=bloc_div>
<blockquote>***Swiss innovative activity could be underestimated by around 10% if the work of cross-border commuters is not considered.***</blockquote> 
</div>

Instead, patenting by both Swiss residents *and* cross-border commuters has grown rapidly, suggesting that the Swiss economy benefits heavily from cross-border commuting inventors. This is again interesting in light of the findings from <a href = https://www.research-collection.ethz.ch/bitstream/handle/20.500.11850/432769/wp_486.pdf?sequence=1&isAllowed=y target = “_blank”>Beerli, Ruffner, Siegenthaler & Peri (2020)</a>. More cross-border commuting inventors was going hand in hand with more patents filed by *both* Swiss residents *and* commuters. This again supports the argument of these researchers that overall innovative output could indeed have greatly benefited from the additional inflow of cross-border commuting inventors.

<br>

Taken together, cross-border commuters seem to substantially fuel the innovative engine of the Swiss Economy. However, this could be even more apparent for some specific regions and industries than for Switzerland as a whole. The graph below allows you to examine this further for yourself. You can choose a Swiss region (as defined by the <a href = http://www.oecd.org/cfe/regionaldevelopment/territorial-grid.pdf target = “_blank”>OECD</a>) or a technology field (as defined by <a href = xxx target = “_blank”>WIPO</a>) and the graph then displays patent counts and the share of patents invented by cross-border commuters for your selected region or technology fields.

Note that in contrast to the previous plot, the counts and shares are not calculated annually but over a 3-year period. This is because the number of patents in a single year can be rather low for some industries and cross-border commuter shares would highly fluctuate. Using 3-year periods instead smooths such fluctuations. Further, note that cross-border commuting was restricted from and to border regions before the liberalizations at the beginning of the 21st century. There are nonetheless some cross-border commuters registered in the non-border region of Central Switzerland (covering the cantons Luzern, Uri, Schwyz, Zug, Nidwalden and Obwalden). The most likely reasons for this are that these inventors were either not cross-border commuters in a legal sense (e.g. they were Swiss residents but also had a foreign address which they stated on the patent documentation) or the patent was only filed by a company headquarter in Central Switzerland, whereas the actual research was conducted in a lab in the border region. 

<br>

```{r, echo = FALSE, message = FALSE, fig.height = 3}

#### CROSS-BORDER COMMUTERS IN SWISS REGIONS & INDUSTRIES --------------------------------

# (1) apply the custom reshape_fun()-function to both data-sets and combine technology field names
plot_df <- lapply(c("CH_region",
                    "CH_Techfields"), function(x) reshape_fun(dataset = x))
names(plot_df) <- c("CH_region", "CH_Techfields")

# (2) specify picker_input() selection options
REGIONS <- as.list(as.character(unique(na.omit(plot_df$CH_region$regio_pat))))
names(REGIONS) <- REGIONS

tech_field_name <- paste(plot_df$CH_Techfields$tech_field,
                         plot_df$CH_Techfields$tech_name)
tech_field_name <- unique(tech_field_name)
TECHFIELDS <- as.list(as.character(unique(na.omit(plot_df$CH_Techfields$tech_field))))
names(TECHFIELDS) <- tech_field_name

# (2) choose between region or industry and define the data ------------------------------
radioButtons(inputId = "region_or_industry",
             label = NULL, choiceNames = c("Region", "Technology Field"),
             choiceValues = c("CH_region", "CH_Techfields"), selected = "CH_region",
             inline = TRUE)

conditionalPanel(condition = "input.region_or_industry == 'CH_region'",
                 pickerInput(
                   inputId = "OBS_reg",
                   label = "Choose a region", selected = "Northwestern Switzerland",
                   choices = REGIONS,
                   multiple = FALSE))

conditionalPanel(condition = "input.region_or_industry == 'CH_Techfields'",
                 pickerInput(
                   inputId = "OBS_ind",
                   label = "Choose a technology field", selected = "16 Pharmaceuticals",
                   choices = TECHFIELDS,
                   multiple = FALSE))

# (3) make the plot ---------------------------------------------------------------------

## STATIC
renderPlot({

  # specify data and parameters
  plot_data <- plot_df[[input$region_or_industry]]
  subsetter <- colnames(plot_data)[1]
  if(subsetter == "tech_field"){
    keep_obs <- which(as.character(plot_data[, subsetter]) == input$OBS_ind)}else{
    keep_obs <- which(as.character(plot_data[, subsetter]) == input$OBS_reg)
    }
  plot_data <- plot_data[keep_obs, ]
  plot_data <- filter(plot_data, p_year <= 2011)
  
  # define the plot parameters
  ylim_absolute <- c(0, max(plot_data$number, na.rm = TRUE))
  ylim_share <- c(0, max(plot_data$share, na.rm = TRUE))
  b <- diff(ylim_absolute)/diff(ylim_share)
  a <- b*(ylim_absolute[1] - ylim_share[1])

  # make the plot
  ggplot(plot_data)+
    geom_area(aes(x = p_year, y = - a + number / b, fill = Type), alpha = 0.8)+
    geom_line(aes(x = p_year, y = share), color = "black", size = 1)+
    scale_fill_viridis(discrete = TRUE, option = "inferno", begin = 0.3, end = 0.7,
                     labels = c("Patents by cross-border commuters", "Patents by Swiss residents"), name = "") +
    scale_y_continuous("Share of patents by cross-border commuters",
                     sec.axis = sec_axis(~ (. + a) * b, name = "Total number of patents"),
                     labels = scales::percent)+
    xlab("Year") +
    theme(legend.position="bottom",
          panel.background = element_blank(),
          panel.grid.major.y = element_line(colour = "black", linetype = "dotted"),
          axis.title = element_text(face = "bold"),
          axis.line = element_line())
  })

## DYNAMIC
# renderPlotly({
# 
#   # define the data
#   plot_data <- plot_df[[input$region_or_industry]]
#   subsetter <- colnames(plot_data)[1]
#   if(subsetter == "tech_field"){
#     keep_obs <- which(as.character(plot_data[, subsetter]) == input$OBS_ind)}else{
#     keep_obs <- which(as.character(plot_data[, subsetter]) == input$OBS_reg)
#     }
#   plot_data <- plot_data[keep_obs, ]
#   
#   # define the plot parameters
#   ylim_absolute <- c(0, max(plot_data$number, na.rm = TRUE))
#   ylim_share <- c(0, max(plot_data$share, na.rm = TRUE))
#   b <- diff(ylim_absolute)/diff(ylim_share)
#   a <- b*(ylim_absolute[1] - ylim_share[1])
# 
#   # make the plot
#   ggplotly(
#     ggplot(plot_data)+
#     geom_area(aes(x = p_year, y = number, fill = Type, label = Status), alpha = 0.8)+
#     geom_line(aes(x = p_year, y = a + share * b, label = Share), color = "black")+
#     scale_fill_viridis(discrete = TRUE, option = "inferno", begin = 0.3, end = 0.7,
#                        labels = c("Patents by cross-border commuters", "Patents by Swiss residents"), name = "") +
#     scale_y_continuous("Total number of patents",
#                        sec.axis = sec_axis(~ (. - a) / b,
#                                            name = "Share of patents by cross-border commuters")
#                        )+
#     xlab("Year") +
#     theme(legend.position="none",
#           panel.background = element_blank(),
#           panel.grid.major.y = element_line(colour = "black", linetype = "dotted"),
#           axis.title = element_text(face = "bold"),
#           axis.line = element_line()),
# 
#      tooltip = c("label", "text"), dynamicTicks = FALSE)
# })
```
<span style="font-size:0.8em">*Source: Authors' own estimations based on data from the <a href="https://www.uspto.gov/" target ="blank">USPTO</a> and the <a href="http://www.oecd.org/sti/inno/intellectual-property-statistics-and-analysis.htm" target ="blank">OECD</a> . The data used for this plot is available on  <a href=https://github.com/cieb-unibas/innovation-origins" target="_blank">GitHub</a>.*</span>

<br>

The share of patents by cross-border commuters varies from only around 0.5-1% in Espace Mittelland to a maximum of up to 30% in the border regions Northwestern Switzerland and Ticino. The same is true for different technology fields. “16 Pharmaceuticals”, which is the most important export sector of the Swiss economy, is also the field that employs by far the highest share of cross-border commuting inventors (up to over 30%). Similarly, many other fields related to chemistry and biology also have relatively high shares of cross-border commuting inventors. For both fields, this is most likely due to the location of Switzerlands most important pharmaceutical and chemistry cluster in Basel. 

Another interesting observation is that the number of patents and the share of cross-border commuting inventors have both been increasing over time in booming fields such as “4 Digital communication”, “6 Computer technology”, “24 Environmental technology”, “27 Engines, pumps and turbines” or “13 Medical technology”. This could imply that having the possibility to recruit cross-border commuters is particularly important in such dynamic and emerging technology fields.

<div class=bloc_div>
<blockquote>***Open borders are key for high-quality innovations in Switzerland.***</blockquote> 
</div>

What all of this shows is that open borders are key for high-quality innovations in Switzerland. Without having the possibility to recruit cross-border commuting inventors, Switzerland’s overall patent output could be already 10% lower. Besides cross-border workers Switzerland also employs a high number of high-skilled immigrants. If the Swiss economy could no longer benefit from the knowledge of all these foreign workers, its innovative capacity would most likely severely deteriorate. This would be particularly alarming as cross-border commuting inventors seem to be especially important in highly dynamic technology fields such as computer science, biotechnology, pharmaceuticals or environmental technologies.   

<br>
<br>



<span style="font-size:0.8em">*This report was written using <a href = https://rmarkdown.rstudio.com/ target = “_blank”>R Markdown</a>, <a href = https://shiny.rstudio.com/ target = “_blank”>shiny</a> and <a href = https://www.rdocumentation.org/packages/plotly/versions/4.9.2.1 target = “_blank”>plotly</a>. Calculations to identify cross-border commuting patent inventors were performed at <a href = http://scicore.unibas.ch/ target = “_blank”> sciCORE </a> scientific computing center at the University of Basel. Data and code to reproduce the figures presented in this article are available on <a href=https://github.com/cieb-unibas/innovation-origins" target="_blank">GitHub<a/>.*</span>

<br>
