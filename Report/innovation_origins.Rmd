---
output: 
   html_document:
      css: style.css
runtime: shiny
fig_caption: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library("shiny")
library("shinydashboardPlus")
library("ggplot2")
library("viridis")
library("RColorBrewer")
library("knitr")
library("png")
library("cowplot")
library("plotly")
library("shinyWidgets")
library("tidyverse")
library("data.table")
```

<!-- <head> -->
<!-- <!-- Global site tag (gtag.js) - Google Analytics --> -->
<!-- <script async src="https://www.googletagmanager.com/gtag/js?id=UA-71167447-1"></script> -->
<!-- <script> -->
<!--   window.dataLayer = window.dataLayer || []; -->
<!--   function gtag(){dataLayer.push(arguments);} -->
<!--   gtag('js', new Date()); -->
<!--   gtag('config', 'UA-71167447-1'); -->
<!-- </script> -->
<!-- </head> -->

<br>

<a href="http://cieb.unibas.ch/" target = "_blank">![Foo](cieb.png){ width=25% }</a>
```{r, echo = F}
socialButton(url = "http://github.com/cieb-unibas",  type = "github")
socialButton(url = "https://twitter.com/cieb_unibas",  type = "twitter")
a(actionButton(inputId = "email1", label = "Mail us",
                 icon = icon("envelope", lib = "font-awesome")),
    href="mailto:cieb@unibas.ch")
```

<br>

## <font color='#68838B'>**Cross-border commuting and inventions 'Made in Switzerland'** </font>

*September 2020* by <a href="https://wwz.unibas.ch/de/personen/matthias-niggli/" target = "_blank">Matthias Niggli</a> and <a href="https://wwz.unibas.ch/de/personen/christian-rutzer/" target = "_blank">Christian Rutzer</a>
```{r, echo = F}
renderText("Share this article") 
    socialButton(url = "http://twitter.com/", type = "twitter")
    socialButton(url = "http://facebook.com/", type = "facebook")
    socialButton(url = "http://linkedin.com/", type = "linkedin")
    socialButton(url = "http://xing.com/", type = "xing")
```

**Every day over 300 000 people from neighboring countries cross the border to work in Switzerland. Many of them contribute substantially to the development of new innovations by Swiss companies. At the same time, many standard innovation indicators do not properly take this Swiss-specific phenomenon into account and the Swiss economy could be even more innovative than generally thought. In fact, innovative activity could be underestimated by around 10% for the country as a whole - and by up to 30% for some specific regions and industries.**

<br>

Cross-border commuters are important for the Swiss economy. This is especially the case for some Swiss regions and the industries that these regions have specialized in. For example, the most recent figures of the <a href = https://www.bfs.admin.ch/bfs/en/home/statistics/work-income/employment-working-hours/employed-persons/swiss-foreign-nationals/cross-border-commuters.html target = “_blank”> Swiss Federal Statistic Office</a> highlight that the Lake Geneva region and the region of Northwestern Switzerland together attract already almost 200 000 cross-border commuters. As for industries, we can, for example, look at the Swiss pharmaceutical sector – notably the country’s largest exporter. The pharmaceutical industry employs so many cross-border commuters that without taking them into account its labor productivity would, for example, be substantially overestimated (see  <a href = Link Output Dragan target = “_blank”>Title Output Dragan </a>). 

If cross-border commuters play such an important role for overall economic activity in Switzerland, what about their role for the development of new inventions? Are these workers also substantially contributing to innovations by Swiss companies? And are there differences across industries in how strongly they rely on cross-border commuting workers? In what follows, this article takes a closer look at such questions.

<br>

#### <font color='#68838B'>**How to determine the origin of an invention?**</font>

Every other year, reports such as the <a href = https://www.globalinnovationindex.org/Home target = “_blank”>Global Innovation Index</a>, the <a href = https://www.weforum.org/reports/how-to-end-a-decade-of-lost-productivity-growth target = “_blank”>Global Competitiveness Report</a> or the <a href = https://www.wipo.int/publications/en/series/index.jsp?id=38 target= “_blank”>World Intellectual Property Report</a> evaluate the innovative capacity of countries. One of the measures these studies typically use are patents. More precisely, they look at the number of patents that were filed by inventors of a given country. This number can be determined because patent documentations always state the residence countries of all the inventors for any given patent. You can see this in an example below.

<br>
<center>
<a href="https://patentimages.storage.googleapis.com/2d/2c/18/51725e50ce657b/US10029262.pdf" target = "_blank">
![](example_patent_multicountry.jpg){ width=60% }</a> 
</center>
<br>

This patent states nine different “Inventors”. Five are from Germany and four are from Switzerland. As the German locations (e.g. Hamburg) and the Swiss ones (e.g. Bern) are rather far away from each other, tThis indicates that two different labs collaborated for this patent and the inventors did not all work in the same workplace. one Some part of the research for the patent was was probably done conducted in Germany on and the other some was in Switzerland. There are two possibilities to link patents to countries Iif more than one country is mentioned on a patent. The first option is to simply raise the patent count of all the mentioned countries equally by one. The second option is to proportionally divide the patent among the countries according to the share of inventors from each country. With the first option, our example-patent would be equally assigned to Germany and Switzerland. With the latter one, 5/9 of the patent would be assigned to Germany and 4/9 to Switzerland. This approach takes into account that there were more German than Swiss residents involved in the development of the patent.

There is also a third option. Instead of focusing on inventors, one can consider the location of the company that owns the patent. In our example, this is the location of the patent’s “Assignee”. In this case, the patent is owned by selFrag AG from Kerzers, Switzerland, and it would therefore be attributed to Switzerland only. Because of this - and also because patents are sometimes filed by foreign subsidiaries or headquarters - company addresses are rarely used to determine patent origins. For more information, a recent report by <a href = https://www.bertelsmann-stiftung.de/fileadmin/files/user_upload/BST_Weltklassepatente_2020_DT.pdf target = “_blank”>Bertelsmann (p. 68)</a> briefly and comprehensively discusses the pros and cons of these different options. The optimal choice mostly depends on the question one wants to answer. In this article, we want to investigate innovative capacities in Switzerland. For this purpose, it is best to follow the most common approach, which is to look at inventor addresses and to use shares to assign patents to countries.

Now, for the case of Switzerland, recall the very high numbers of cross-border commuters in, for example, Geneva or Basel. What if *all* the inventors of a patent developed in Switzerland live in neighboring countries and commute to a workplace in Switzerland? Such a patent would not be assigned to Switzerland even though all the research and development was conducted in a Swiss Lab. In addition, focusing on the location of the firm would also not solve the problem if the patent was filed by a foreign affiliate of the Swiss-based firm. The picture below shows an example of a patent with exactly these characteristics.

<br>
<center>
<a href="https://patentimages.storage.googleapis.com/d3/fc/90/f9374c9864e9b2/US7786128.pdf" target = "_blank"> ![](example_patent_crossbord.jpg){ width=60% }</a>
</center>
<br>

All the inventors of this patent live in Germany or France and the assignee of the patent is a U.S.-affiliate of Swiss pharmaceutical giant Hoffmann-La Roche. With the above-mentioned approaches, such a patent would never be attributed to Switzerland. However, the places of residence of all inventors are very close to the region of Basel (e.g. Grenzach-Wylen, Freiburg). Furthermore, Hoffmann-La Roche’s headquarter is located in Basel and some of its major research facilities are in this region. Therefore, it is very likely that this patent was in fact developed in Basel by cross-border commuters from Germany and France and later filed at the U.S. Patent Office (USPTO) by the U.S. branch of Hoffmann-La Roche. The actual invention, however, was conducted in Switzerland and the patent should thus also be attributed to Switzerland.

In order to identify and re-assign such patents, we have developed an approach, which we explain in the next section.

<br>

#### <font color='#68838B'>**Searching for cross-border commuting inventors – The empirical approach** </font>

<details>
  <summary>**Click to expand**</summary>
  
  A patent is a candidate for being co-invented by a cross-border commuter if the resident country of the company that owns the patent is Switzerland, but the inventor’s resident country is not.
  
  However, keeping this as a final definition for cross-border commuters would be highly imprecise. Recall our first example patent, where the company was in Switzerland but one of the German inventors lived in Hamburg. It is almost impossible that somebody is commuting over such a huge distance. 
  
  Therefore, we additionally introduce a maximum distance between company and inventor into our definition. Fortunately, patents filed at the USPTO not only feature the places of residence of inventors and companies but also their coordinates. This is not the case for patents filed at the European Patent Office (EPO). For such patents, we need a different approach, which we outline further below. For USPTO patents, however, we can calculate exact distances between a company’s and an inventor’s location. We assign the cross-border commuter status only if (a) inventors are not living in Switzerland **and** (b) the company that owns the patent is based in Switzerland **and** (c) inventors are not living too far away from where the Swiss company is located. Consequently, an inventor who is mentioned on a patent filed by a Swiss company, but is living in Hamburg would not be considered as a cross-border commuter. In turn, an inventor living in Loerrach would be.
  
  However, this might still miss some cross-border commuters. What if the Swiss company did file the patent through a foreign affiliate as in our second example? The solution is to (…)
  
  Sometimes Swiss companies might file patents only at the EPO and not at the USPTO. Up to now, we have not included such patents in the analysis up. This could be a major shortcoming and we thus develop an approach to also check for cross-border commuters on EPO patents. We proceed in the following way: First, because we already reassigned USPTO patents, we only consider EPO patents from Swiss-based companies that do not have an equivalent USPTO patent. As before, we then check if the resident country of the company that owns the patent is Switzerland, but the inventor’s resident country is not. Subsequently, we have to consider that for commuting to be realistic, the locations of inventors and the company should not be too far away. As EPO patents do not state exact coordinates, we use the region where an inventor lives for this. We assume that all inventors who live outside the following regions cannot be cross-border commuters, because the distance to the Swiss border would then be too far away: For Germany, we take the regions of "Freiburg" and "Schwaben". For, France we take "Alsace", "Rhône-Alpes", "Lorraine" and "Franche-Comté", for Italy "Lombardy" and "Piedmont" and for Austria the region of “Vorarlberg”. All other regions are excluded. Furthermore, we restrict the definition in such a way that inventors from Germany only commute to the Swiss regions "Northwestern Switzerland", "Zürich" or "Eastern Switzerland", Italians only to the “Ticion” region, Austrians only to “Eastern Switzerland” and French commuters only to "Northwestern Switzerland" or the "Lake Geneva" region. Taken together, we assign the cross-border commuter status on EPO patents only if (a) inventors are not living in Switzerland but in regions close to its borders **and** (b) the company that owns the patent is based in Switzerland **and** (c) the company is located in a Swiss region close to the foreign region the inventor lives. Combined, these definitions suggest that our approach to identify cross-border commuters on EPO patents should result in a lower bound.
  
  Putting everything together, we find that 23 047 patents  were likely co-developed by cross-border commuters in Switzerland.  In the next section, we highlight how this affects how we look at Swiss innovation activity.
</details>

<br>

#### <font color='#68838B'>**Cross-border commuters and innovation in Switzerland** </font>

<br>

```{r, echo = FALSE}
## LOAD ALL .CSV FILES
csv_files <- list.files(pattern = ".csv")
df_list <- lapply(csv_files, read.csv)
names(df_list) <- gsub(pattern = ".csv", replacement = "", csv_files)
```

```{r, echo = FALSE}
#### CROSS-BORDER COMMUTERS IN SWITZERLAND:  AREAPLOT & LINEPLOT ---------------------

# load and prepare the data 
plot_data <- df_list[["CH_overall"]]
plot_data <- plot_data %>%
  filter(p_year <= 2015) %>%
  gather(key = Type, value = number, Swiss_based, commuters)
plotly_labels <- ifelse(plot_data$Type == "Swiss_based", 
                        "Swiss residents", "Cross-border commuters")

# parameters to transform data for defining a 2nd axis for the share:
ylim_absolute <- c(0, 5000)
ylim_share <- c(0.7, 1.3)
b <- diff(ylim_absolute)/diff(ylim_share)
a <- b*(ylim_absolute[1] - ylim_share[1])

# make the plot
p <- ggplot(plot_data)+
  geom_area(aes(x = p_year, y = number, fill = Type), alpha = 0.7)+
  scale_fill_viridis(discrete = TRUE) +
  geom_line(aes(x = p_year, y = a + share * b), color = "black")+
  geom_point(aes(x = p_year, y = a + share * b), color = "black")+
  geom_hline(yintercept = a + 1 * b, color = "red", linetype = "dotted")+
  scale_y_continuous("Number of Patents",
                     sec.axis = sec_axis(~ (. - a)/b, 
                                         name = "Share of patents invented by cross-border commuters")) +
  xlab("Year") +
  theme(legend.position="none",
        panel.background = element_blank(),
        axis.line.y = element_line(),
        axis.line = element_line())
p

# display the plot
# ggplotly(p, tooltip = "text")

```


```{r, echo = FALSE}
#### CROSS-BORDER COMMUTERS IN SWISS INDUSTRIES:  DYNAMIC LINEPLOT ---------------------

```


```{r, echo = FALSE}
#### CROSS-BORDER COMMUTERS IN SWISS REGIONS:  DYNAMIC AREAPLOT ---------------------

```


```{r, echo = FALSE}
#### ORIGIN OF CROSS-BORDER COMMUTERS: AREAPLOT ---------------------
plot_data <- df_list[["neighboring_ctry"]] %>% filter(p_year <= 2015)
ggplot(plot_data)+
  geom_area(aes(x = p_year, y = count, fill = ctry_inv))+
  scale_fill_viridis(discrete = TRUE) +
  labs( x = "Year", y = "Number of cross-border commuting inventors") +
  theme(panel.background = element_blank(),
        axis.line = element_line())
```







